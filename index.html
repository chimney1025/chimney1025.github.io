<!DOCTYPE html>
<html>
<head lang="en">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
    <title>Index</title>
    <style>
      html {
        font-size: 14px;
      }
      
      .input {
        width: 100%;
        float: left;
      }
      
      .result {
        width: 100%;
      }
      
      .result #search {
        width: 50px;
        float: left;
        margin: 100px 10px 0 10px;
        
      }
      
      .result textarea, .result #result {
        margin: 10px;
        float: left;
        min-width: 250px;
        min-height: 300px;
        border: 1px solid #333;
        padding: 10px;
      }
      
      
      
     
    </style>
</head>
<body>

<div class="input">
<input id="key" type="text" placeholder="请输入中文">
<input id="value" type="text" placeholder="请输入读音">
<input id="add" type="button" value="点击或回车添加">
<input id="getAll" type="button" value="查看已有词库">
</div>

<div class="result">
<textarea id="searchInput" placeholder="请输入中文歌词 （示例：可贴入《万水千山总是情》简体版进行转换）"></textarea>
<input id="search" type="button" value="==>">
<div id="result"></div>
</div>

<script>
function Words() {
  var dict = {};
  reset();
  
  function reset() {
    if(localStorage.getItem("words")) {
        dict = JSON.parse(localStorage.getItem("words"));
    } else {
        dict = {};
    }
  }
  
  return {
    add: function(key, value) {
        dict[key] = value;
        localStorage.setItem("words", JSON.stringify(dict));
    },
    
    search: function(key) {
        return dict[key];
    },
    
    getAll: function() {
        return dict;
    },
    
    reset: function() {
        reset();
    }
  };
}

function Display() {
    
  var words = new Words();
  
  function getAll() {
            var results = words.getAll();
            document.getElementById('result').innerHTML = "";
            for(var key in results) {
                var node = document.createElement("div");
                node.innerHTML = "- " + key + " : " + results[key] + "<br>";
                document.getElementById('result').appendChild(node);
            }
  }
  
  function addWord() {
              var key = document.getElementById('key').value.trim();
              var value = document.getElementById('value').value.trim();
              if(key && value) {
                words.add(key, value);
                document.getElementById('key').value = '';
                document.getElementById('value').value = '';
                document.getElementById('key').focus();
                
                getAll();
              }
  }
  
  return {
    
    import: function(orig) {
        var dict = {};
        //var orig = document.getElementById("result").textContent;
        var arr = orig.split('- ');
        for(var i=0; i<arr.length; i++) {
          if(arr[i]) {
            var key = arr[i].split(" : ")[0];
            var value = arr[i].split(" : ")[1];
            dict[key] = value;
            localStorage.setItem("words", JSON.stringify(dict));
          }
        }
    },
    
    clearStorage: function() {
        localStorage.removeItem("words");
        words.reset();
    },
    
    setStorage: function(json) {
        localStorage.setItem("words", JSON.stringify(json));
        words.reset();
    },
    
    init: function() {
        
        document.getElementById('add').addEventListener('click', addWord);
    
        document.getElementById('value').addEventListener('keydown', function(event) {
            if(event.keyCode == 13) {
              addWord();
            }
        });
        
        document.getElementById('getAll').addEventListener('click', getAll);

        document.getElementById('search').addEventListener('click', function() {
              document.getElementById('result').innerHTML = "";
              var list = document.getElementById('searchInput').value.trim().split('');
              
              for(var i=0; i<list.length; i++) {
                var key = list[i];
                if(key) {
                    if(key == "\n" || key == "\r\n") {
                        var node = document.createElement("div");
                        node.innerHTML = "<br>";
                        document.getElementById('result').appendChild(node);
                    } else {
                        var value = words.search(key);
                        if(!value) {
                          value = "";
                        }
                    
                        var node = document.createElement("span");
                        node.innerHTML = key + value + " ";
                        document.getElementById('result').appendChild(node);
                    }
                }
              }
        });
    }
  };
}

var dict = new Display();
dict.init();

//Example data
var data = {"莫":"mou","说":"syut","青":"cing","山":"saan","多":"do","障":"zoeng","碍":"ngoi","风":"fung","也":"jaa","急":"gap","劲":"ging","白":"baak","云":"wan","过":"gwo","峰":"fung","可":"ho","传":"zyun","情":"cing","水":"seoi","中":"zung","变":"bin","幻":"waan","清":"cing","静":"zing","柔":"jau","似":"ci","爱":"ngoi","共":"gung","永":"wing","未":"mei","怕":"paa","罡":"gong","吹":"ceoi","散":"saan","了":"liu","热":"jit","万":"mak","千":"cin","总":"zung","是":"si","聚":"zeoi","有":"jau","天":"tin","注":"zyu","定":"ding","不":"bat","怨":"jyun","命":"ming","但":"daan","求":"kau","作":"zok","证":"zing"};
dict.setStorage(data);

</script>

</body>
</html>
